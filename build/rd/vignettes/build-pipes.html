

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ingredients &mdash; flowr 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="flowr 0.1 documentation" href="../../index.html"/>
        <link rel="up" title="Building Pipelines" href="../../build.html"/>
        <link rel="next" title="HPCC submission formats" href="../../hpcc-interface.html"/>
        <link rel="prev" title="Building Pipelines" href="../../build.html"/>


<script src="../../_static/labibi.js"></script>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-16853172-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../index.html" class="icon icon-home"> flowr
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">Get me started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quick-start.html#toy-example">Toy example</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick-start.html#stitch">Stitch</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick-start.html#plot">Plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick-start.html#test-it">Test it</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick-start.html#submit-it">Submit it !</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick-start.html#check-the-status">Check the status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hpcc-support.html">HPCC Platforms</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../pipelines.html">Available pipelines</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../build.html">Building Pipelines</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Ingredients</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#flow-definition">Flow Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flow-mat-a-table-with-all-the-commands-to-run">flow_mat: A table with all the commands to run</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#submission-types">Submission types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependency-types">Dependency types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#relationships">Relationships</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#serial-one-to-one-relationship">Serial: one to one relationship</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gather-many-to-one-relationship">Gather: many to one relationship</a></li>
<li class="toctree-l3"><a class="reference internal" href="#burst-one-to-many-relationship">Burst: one to many relationship</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-interface">Cluster interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flow-def-columns">flow_def columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hpcc-interface.html">HPCC submission formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hpcc-interface.html#flow-def-and-final-submission">flow_def and final submission</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../topics.html">Help on available functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../topics/flow.html">flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/flow.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/flow.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/flow.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/get_flow_status.html">get_flow_status</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/get_flow_status.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/get_flow_status.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/get_flow_status.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/job.html">job</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/job.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/job.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/job.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/kill_flow.html">kill_flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/kill_flow.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/kill_flow.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/kill_flow.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/plot_flow.html">plot_flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/plot_flow.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/plot_flow.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/plot_flow.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/queue.html">queue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/queue.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/queue.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/queue.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/rerun_flow.html">rerun_flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/rerun_flow.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/rerun_flow.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/rerun_flow.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/setup.html">setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/setup.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/setup.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/setup.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/submit_flow.html">submit_flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/submit_flow.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/submit_flow.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/submit_flow.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/submit_job.html">submit_job</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/submit_job.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/submit_job.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/submit_job.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../topics/to_flow.html">to_flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/to_flow.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/to_flow.html#value">Value</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/to_flow.html#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faqs.html">FAQs</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">flowr</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../build.html">Building Pipelines</a> &raquo;</li>
      
    <li>Ingredients</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/rd/vignettes/build-pipes.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  
  <p>An easy and quick way to build a workflow is create two separate files. First is a table with commands to run the other has details regarding how the modules are stitched together. In the rest of this document we would refer to them as flow_mat and flow_def respectively.</p>
<p>Both these files have a <code class="docutils literal"><span class="pre">jobname</span></code> column which is used as a ID to connects them both.</p>
<div class="section" id="ingredients">
<h1>Ingredients<a class="headerlink" href="#ingredients" title="Permalink to this headline">¶</a></h1>
<div class="code r highlight-python"><div class="highlight"><pre><span class="n">exdata</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">package</span> <span class="o">=</span> <span class="s">&quot;flowr&quot;</span><span class="p">),</span> <span class="s">&quot;extdata&quot;</span><span class="p">)</span>
<span class="n">flow_mat</span> <span class="o">=</span> <span class="n">read_sheet</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">exdata</span><span class="p">,</span> <span class="s">&quot;example1_flow_mat.txt&quot;</span><span class="p">))</span>
<span class="n">flow_def</span> <span class="o">=</span> <span class="n">read_sheet</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">exdata</span><span class="p">,</span> <span class="s">&quot;example1_flow_def.txt&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="flow-definition">
<h2>Flow Definition<a class="headerlink" href="#flow-definition" title="Permalink to this headline">¶</a></h2>
<p>Each row in this table refers to one step of the pipeline. It describes the resources used by this step and also its relationship with other steps. Especially the step immediately prior to it.</p>
<p>This is a tab separated file, with a minimum of 4 columns.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">jobname</span></code>: Name of the step</li>
<li><code class="docutils literal"><span class="pre">sub_type</span></code>: Submission type, how should multiple commands of this step be submission. Can take values <code class="docutils literal"><span class="pre">serial</span></code> or <code class="docutils literal"><span class="pre">scatter</span></code>.</li>
<li><code class="docutils literal"><span class="pre">prev_job</span></code>: Short for previous job. This can be NA/./none if this is a independent step, and not previous step is required for this to start.</li>
<li><code class="docutils literal"><span class="pre">dep_type</span></code>: Dependency type, refers to the relationship of this job with the that defined in previous job. This can take values <code class="docutils literal"><span class="pre">none</span></code>, <code class="docutils literal"><span class="pre">gather</span></code>, <code class="docutils literal"><span class="pre">serial</span></code> or <code class="docutils literal"><span class="pre">burst</span></code>.</li>
</ul>
<p>Apart from these, there are several other variables which define the resource requirements of each step. This gives great amount of flexibility to the user in choosing CPU, wall time, memory and queue for each step (These are all passed along to the HPCC platform).</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">cpu_reserved</span></code></li>
<li><code class="docutils literal"><span class="pre">memory_reserved</span></code></li>
<li><code class="docutils literal"><span class="pre">nodes</span></code></li>
<li><code class="docutils literal"><span class="pre">walltime</span></code></li>
<li><code class="docutils literal"><span class="pre">queue</span></code></li>
</ul>
<p>Most cluster platforms accept these arguments. These are used to fill up the variables defined in curly braces. Example <code class="docutils literal"><span class="pre">{{{CPU}}}</span></code> in this file for <a class="reference external" href="https://github.com/sahilseth/flowr/blob/master/inst/conf/torque.sh">torque</a></p>
<p>If these (resource requirements) columns not included in the flow_def, their values should be explicitly defined in the submission template.</p>
<p>Here is an example <a class="reference external" href="https://raw.githubusercontent.com/sahilseth/flowr/master/inst/extdata/example1_flow_def2.txt">flow_def</a> file.</p>
<!-- Each row of this table translates to a call to ([job](http://docs.flowr.space/build/html/rd/topics/job.html) or) [queue](http://docs.flowr.space/build/html/rd/topics/queue.html) function. --><!--
- jobname: is passed as `name` argument to job().
- prev_jobs: passed as `previous_job` argument  to job().
- dep_type: passed as `dependency_type` argument  to job(). Possible values: gather, serial
- sub_type: passed as `submission_type` argument  to job().
- queue: name of the queue to be used for this particular job.
    Since each jobs can be submitted to a different queue, this makes your flow very flexible
- memory_reserved: Refer to your system admin guide on what values should go here.
    Some examples: 160000, 16g etc representing a 16GB reservation of RAM
- walltime: How long would this job run. Again refer to your HPCC guide. Example: 24:00, 24:00:00
- cpu_reserved: Amount of CPU reserved.

Its best to have this as a tab seperated file (with no row.names). --><div class="code r highlight-python"><div class="highlight"><pre><span class="n">kable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">flow_def</span><span class="p">))</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="13%" />
<col width="12%" />
<col width="12%" />
<col width="9%" />
<col width="18%" />
<col width="11%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">jobname</th>
<th class="head">prev_jobs</th>
<th class="head">dep_type</th>
<th class="head">sub_type</th>
<th class="head">queue</th>
<th class="head">memory_reserved</th>
<th class="head">walltime</th>
<th class="head">cpu_reserved</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>sleep</td>
<td>none</td>
<td>none</td>
<td>scatter</td>
<td>medium</td>
<td>163185</td>
<td>23:00</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>tmp</td>
<td>sleep</td>
<td>serial</td>
<td>scatter</td>
<td>medium</td>
<td>163185</td>
<td>23:00</td>
<td>1</td>
</tr>
<tr class="row-even"><td>merge</td>
<td>tmp</td>
<td>gather</td>
<td>serial</td>
<td>medium</td>
<td>163185</td>
<td>23:00</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>size</td>
<td>merge</td>
<td>serial</td>
<td>serial</td>
<td>medium</td>
<td>163185</td>
<td>23:00</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="flow-mat-a-table-with-all-the-commands-to-run">
<h2>flow_mat: A table with all the commands to run<a class="headerlink" href="#flow-mat-a-table-with-all-the-commands-to-run" title="Permalink to this headline">¶</a></h2>
<p>This is also a tab separated table, with a minimum of three column as defined below:</p>
<ul class="simple">
<li>samplename: A grouping column. The table is split using this column and each subset is treated as a individual flow. This makes it very easy to process multiple samples using a single submission command.<ul>
<li>If all the commands are for a single sample, one can just repeat a dummy name like sample1 all throughout.</li>
</ul>
</li>
<li>jobname: This corresponds to the name of the step. This should match exactly with the jobname column in flow_def table defined above.</li>
<li>cmd: A shell command to run. One can get quite creative here. These could be multiple shell commands separated by a <code class="docutils literal"><span class="pre">;</span></code> or <code class="docutils literal"><span class="pre">&amp;&amp;</span></code>, more on this <code class="docutils literal"><span class="pre">here</span> <span class="pre">&lt;http://stackoverflow.com/questions/3573742/difference-between-echo-hello-ls-vs-echo-hello-ls&gt;</span></code>_.</li>
</ul>
<p>Here is an example <a class="reference external" href="https://raw.githubusercontent.com/sahilseth/flowr/master/inst/extdata/example1_flow_mat.txt">flow_mat</a></p>
<div class="code r highlight-python"><div class="highlight"><pre><span class="n">kable</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">flow_mat</span><span class="p">,</span> <span class="n">samplename</span> <span class="o">==</span> <span class="s">&quot;sample1&quot;</span><span class="p">))</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="17%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">samplename</th>
<th class="head">jobname</th>
<th class="head">cmd</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>sample1</td>
<td>sleep</td>
<td>sleep 2 &amp;&amp; sleep 5;echo hello</td>
</tr>
<tr class="row-odd"><td>sample1</td>
<td>sleep</td>
<td>sleep 13 &amp;&amp; sleep 7;echo hello</td>
</tr>
<tr class="row-even"><td>sample1</td>
<td>sleep</td>
<td>sleep 23 &amp;&amp; sleep 7;echo hello</td>
</tr>
<tr class="row-odd"><td>sample1</td>
<td>tmp</td>
<td>head -c 100000 /dev/urandom &gt; tmp1_1</td>
</tr>
<tr class="row-even"><td>sample1</td>
<td>tmp</td>
<td>head -c 100000 /dev/urandom &gt; tmp1_2</td>
</tr>
<tr class="row-odd"><td>sample1</td>
<td>tmp</td>
<td>head -c 100000 /dev/urandom &gt; tmp1_3</td>
</tr>
<tr class="row-even"><td>sample1</td>
<td>merge</td>
<td>cat tmp1_1 tmp1_2 tmp1_3 &gt; merge1</td>
</tr>
<tr class="row-odd"><td>sample1</td>
<td>size</td>
<td>du -sh merge1; echo MY shell: $SHELL</td>
</tr>
</tbody>
</table>
<!---
### Style 2

This style may be more suited for people who like to explore more advanced usage and like to code in R. Also this one find this much faster if jobs and their relationships changes a lot.

Here instead of seperating cmds and definitions one defines them step by step incrementally.

- Use: queue(), to define the computing cluster being used
- Use: multiple calls job()
- Use: flow() to stich the jobs into a flow.


Currently we support LSF, Torque and SGE. Let us use LSF for this example.


```r
qobj <- queue(platform = "lsf", queue = "normal", verbose = FALSE)
```

Let us stitch a simple flow with three jobs, which are submitted one after the other.


```r
job1 <- job(name = "myjob1", cmds = "sleep1", q_obj = qobj)
job2 <- job(name = "myjob2", cmds = "sleep2", q_obj = qobj, previous_job = "myjob1", dependency_type = "serial")
job3 <- job(name = "myjob3", cmds = "sleep3", q_obj = qobj, previous_job = "myjob1", dependency_type = "serial")
fobj <- flow(name = "myflow", jobs = list(job1, job2, job3), desc="description")
plot_flow(fobj)
```

```
#> input x is flow
```

![](figure/plot_simpleflow-1.pdf)

The above translates to a flow definition which looks like this:


```r
dat <- flowr:::create_jobs_mat(fobj)
knitr:::kable(dat)
```



|       |jobname |prev_jobs |dep_type |sub_type |cpu_reserved |nodes | jobid| prev_jobid|
|:------|:-------|:---------|:--------|:--------|:------------|:-----|-----:|----------:|
|myjob1 |myjob1  |          |none     |scatter  |1            |1     |     1|         NA|
|myjob2 |myjob2  |myjob1    |serial   |scatter  |1            |1     |     2|          1|
|myjob3 |myjob3  |myjob1    |serial   |scatter  |1            |1     |     3|          1|
---></div>
</div>
<div class="section" id="example">
<h1>Example:<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h1>
<p>A &#8212;-&gt; B &#8212;&#8211;&gt; C &#8212;&#8211;&gt; D</p>
<p>Consider an example with three steps A, B and C. A has 10 commands from A1 to A10, similarly B has 10 commands B1 to B10 and C has a single command, C1.</p>
<p>Consider another step D (with D1-D3), which comes after C.</p>
</div>
<div class="section" id="submission-types">
<h1>Submission types<a class="headerlink" href="#submission-types" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><em>This refers to the sub_type column in flow definition.</em></div></blockquote>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">scatter</span></code>: submit all commands as parallel, independent jobs.<ul>
<li><em>Submit A1 through A10 as independent jobs</em></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">serial</span></code>: run these commands sequentially one after the other.<ul>
<li><em>Wrap A1 through A10, into a single job.</em></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="dependency-types">
<h1>Dependency types<a class="headerlink" href="#dependency-types" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><em>This refers to the dep_type column in flow definition.</em></div></blockquote>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">none</span></code>: independent job.<ul>
<li><em>Initial step A has no dependency</em></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">serial</span></code>: <em>one to one</em> relationship with previous job.<ul>
<li><em>B1 can start as soon as A1 completes.</em></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">gather</span></code>: <em>many to one</em>, wait for <strong>all</strong> commands in previous job to finish then start the current step.<ul>
<li><em>All jobs of B (1-10), need to complete before C is started</em></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">burst</span></code>: <em>one to many</em> wait for the previous step which has one job and start processing all in the current step.<ul>
<li><em>D1 to D3 are started as soon as C finishes.</em></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="relationships">
<h1>Relationships<a class="headerlink" href="#relationships" title="Permalink to this headline">¶</a></h1>
<p>Using the above submission and dependency types one can create several types of relationships between former and later jobs. Here are a few examples of relationships one may typically use.</p>
<div class="section" id="serial-one-to-one-relationship">
<h2>Serial: one to one relationship<a class="headerlink" href="#serial-one-to-one-relationship" title="Permalink to this headline">¶</a></h2>
<p>A is submitted as scatter, A1 through A10. Similarly B1 through B10 can also be processed independently of each other. Further B1, require A1 to complete; B2 requires A2 and so on.</p>
<p>To set this up, A and B would have <code class="docutils literal"><span class="pre">sub_type</span></code> <code class="docutils literal"><span class="pre">scatter</span></code> and B would have <code class="docutils literal"><span class="pre">dep_type</span></code> as <code class="docutils literal"><span class="pre">serial</span></code>. Further, since A is an initial step its <code class="docutils literal"><span class="pre">dep_type</span></code> and <code class="docutils literal"><span class="pre">prev_job</span></code> would defined as <code class="docutils literal"><span class="pre">none</span></code>.</p>
</div>
<div class="section" id="gather-many-to-one-relationship">
<h2>Gather: many to one relationship<a class="headerlink" href="#gather-many-to-one-relationship" title="Permalink to this headline">¶</a></h2>
<p>Since C is a single command which requires all steps of B to complete, intuitively it would <code class="docutils literal"><span class="pre">gather</span></code> pieces of data generated by B. In this case <code class="docutils literal"><span class="pre">dep_type</span></code> would be <code class="docutils literal"><span class="pre">gather</span></code> and <code class="docutils literal"><span class="pre">sub_type</span></code> type would be <code class="docutils literal"><span class="pre">serial</span></code> since its a single command.</p>
<!---
- makes sense when previous job had many commands running in parallel and current job would wait for all
- so previous job submission: `scatter`, and current job's dependency type `gather`

---></div>
<div class="section" id="burst-one-to-many-relationship">
<h2>Burst: one to many relationship<a class="headerlink" href="#burst-one-to-many-relationship" title="Permalink to this headline">¶</a></h2>
<p>Further, D is a set of three commands (D1-D3), which need to wait for a single process (C1) to complete. They would be submitted as <code class="docutils literal"><span class="pre">scatter</span></code> after waiting on C in a <code class="docutils literal"><span class="pre">burst</span></code> type dependency.</p>
<!---
- makes sense when previous job had one command current job would split and submit several jobs in parallel
- so previous job submission_type: `serial`, and current job's dependency type `burst`, with a submission type: `scatter`

---><p>In essence and example flow_def would look like as follows (with additional resource requirements not shown for brevity).</p>
<div class="code r highlight-python"><div class="highlight"><pre>ex2def = read_sheet(file.path(exdata, &quot;example2_flow_def.txt&quot;))
ex2mat = read_sheet(file.path(exdata, &quot;example2_flow_mat.txt&quot;))
fobj = suppressMessages(to_flow(x = ex2mat, def = ex2def))
kable(ex2def[, 1:4])
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="25%" />
<col width="27%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">jobname</th>
<th class="head">sub_type</th>
<th class="head">prev_jobs</th>
<th class="head">dep_type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>A</td>
<td>scatter</td>
<td>none</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>B</td>
<td>scatter</td>
<td>A</td>
<td>serial</td>
</tr>
<tr class="row-even"><td>C</td>
<td>serial</td>
<td>B</td>
<td>gather</td>
</tr>
<tr class="row-odd"><td>D</td>
<td>scatter</td>
<td>C</td>
<td>burst</td>
</tr>
</tbody>
</table>
<div class="code r highlight-python"><div class="highlight"><pre><span class="n">plot_flow</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure">
<img alt="" src="../../_images/ex2def-1.pdf" />
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is a darker more prominent shadow to indicate scatter steps.</p>
</div>
<p>Here is the <a class="reference external" href="https://raw.githubusercontent.com/sahilseth/flowr/master/inst/extdata/example1_flow_mat.txt">full flow definition</a> used in this example.</p>
</div>
</div>
<div class="section" id="cluster-interface">
<h1>Cluster interface<a class="headerlink" href="#cluster-interface" title="Permalink to this headline">¶</a></h1>
<p>Here is an example submission template: <a class="reference external" href="https://github.com/sahilseth/flowr/blob/master/inst/conf/torque.sh">github.com/sahilseth/flowr/blob/master/inst/conf/torque.sh</a></p>
<p>Other submission templates are also in the same folder.</p>
<p>Add a new platform is streamlined here are a few details: <a class="reference external" href="https://github.com/sahilseth/flowr/issues/7">github.com/sahilseth/flowr/issues/7</a></p>
</div>
<div class="section" id="flow-def-columns">
<h1>flow_def columns<a class="headerlink" href="#flow-def-columns" title="Permalink to this headline">¶</a></h1>
<p>Some columns of flow definition are passed along to the final submisstion script.</p>
<p>Variables in the template are defined in curly braces, example <code class="docutils literal"><span class="pre">{{{CPU}}}</span></code>, these variables are gathered from the flow definition file.</p>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">flow_def_column</th>
<th class="head">hpc_script_variable</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>nodes</td>
<td>NODES</td>
</tr>
<tr class="row-odd"><td>cpu_reserved</td>
<td>CPU</td>
</tr>
<tr class="row-even"><td>memory_reserved</td>
<td>MEMORY</td>
</tr>
<tr class="row-odd"><td>email</td>
<td>EMAIL</td>
</tr>
<tr class="row-even"><td>walltime</td>
<td>WALLTIME</td>
</tr>
<tr class="row-odd"><td>extra_opts</td>
<td>EXTRA_OPTS</td>
</tr>
<tr class="row-even"><td>*</td>
<td>JOBNAME</td>
</tr>
<tr class="row-odd"><td>*</td>
<td>STDOUT</td>
</tr>
<tr class="row-even"><td>*</td>
<td>CWD</td>
</tr>
<tr class="row-odd"><td>*</td>
<td>DEPENDENCY</td>
</tr>
<tr class="row-even"><td>*</td>
<td>TRIGGER</td>
</tr>
<tr class="row-odd"><td>**</td>
<td>CMD</td>
</tr>
</tbody>
</table>
<p>*: These are generated on the fly **: This is gathered from flow_mat</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">My HPCC is not supported, how to make it work? Take a look at: <a class="reference external" href="https://github.com/sahilseth/flowr/issues/7">adding platforms</a> and send a message to: sahil.seth [at] me.com</p>
</div>
</div>




  

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'flowrdocs'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../hpcc-interface.html" class="btn btn-neutral float-right" title="HPCC submission formats" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../build.html" class="btn btn-neutral" title="Building Pipelines" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Sahil Seth.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 



<div id="editor-trap">
      <h3>Edit this document!</h3>

      <p>
        This file can be edited directly through the Web. Anyone can
        update and fix errors in this document with few clicks --
        no downloads needed.
      <p>

      <ol>

        <li>
          Go to
        <a href="https://github.com/ctb/labibi/blob/master/rd/vignettes/build-pipes.rst">
          Ingredients
        </a> on GitHub.
      </li>

        <li>
        <b>Edit</b> files using GitHub's text editor in your web browser (see the 'Edit' tab on the top right of the file)
      </li>

      <li>
        Fill in the <b>Commit message</b> text box at the bottom of the page describing <i>why</i>
        you made the changes. Press the <b>Propose file change</b> button next to it when done.
      </li>

      <li>
        Then click <b>Send a pull request</b>.
      </li>

      <li>
        Your changes are now queued for review under the project's <a href="https://github.com/ctb/labibi/pulls">Pull requests</a> tab on GitHub!
      </li>
      </ol>

      <p>
        For an introduction to the documentation format please see <a href="http://docutils.sourceforge.net/docs/user/rst/quickstart.html">the reST primer</a>.
      </p>

  </div>



<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', UA-36028965-1]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>



</body>
</html>